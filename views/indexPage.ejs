<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>members_only</title>
  <link rel="stylesheet" href="/styles.css">


</head>

<body>

  <%- include('navbar', {navbarLinks:navbarLinks}) %>
    <div class="welcome-div">
      <% if (currentUser) { %>
        <h1 class="welcome-heading">Welcome <%= currentUser.username %>.</h1>

        <% if (currentUser.is_member) { %>
          <div class="verified-badge">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
              stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
              class="lucide lucide-badge-check-icon">
              <path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 
                   4 4 0 0 1 6.74 0 
                   4 4 0 0 1 4.78 4.78 
                   4 4 0 0 1 0 6.74 
                   4 4 0 0 1-4.77 4.78 
                   4 4 0 0 1-6.75 0 
                   4 4 0 0 1-4.78-4.77 
                   4 4 0 0 1 0-6.76Z" />
              <path d="m9 12 2 2 4-4" />
            </svg>
            Verified
          </div>
          <% } %>

            <% if (currentUser.is_admin) { %>
              <div class="admin-badge">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                  stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                  class="lucide lucide-user-star-icon lucide-user-star">
                  <path
                    d="M16.051 12.616a1 1 0 0 1 1.909.024l.737 1.452a1 1 0 0 0 .737.535l1.634.256a1 1 0 0 1 .588 1.806l-1.172 1.168a1 1 0 0 0-.282.866l.259 1.613a1 1 0 0 1-1.541 1.134l-1.465-.75a1 1 0 0 0-.912 0l-1.465.75a1 1 0 0 1-1.539-1.133l.258-1.613a1 1 0 0 0-.282-.866l-1.156-1.153a1 1 0 0 1 .572-1.822l1.633-.256a1 1 0 0 0 .737-.535z" />
                  <path d="M8 15H7a4 4 0 0 0-4 4v2" />
                  <circle cx="10" cy="7" r="4" />
                </svg>
                Admin
              </div>
              <% } %>

                <% } else { %>
                  <h1 class="welcome-heading">Welcome Guest!</h1>
                  <% } %>
    </div>


    <div class="heading-and-buttons-hero-section">
      <h1 class="main-heading">Club - Your Members only space</h1>
      <h2 class="secondary-heading">Members can post messages in the secret club</h2>
      <div class="hero-buttons">

        <% if (currentUser) { %>
          <a class="create-letter-button" href="/letter/new"><svg xmlns="http://www.w3.org/2000/svg" width="24"
              height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round"
              stroke-linejoin="round" class="lucide lucide-square-pen-icon lucide-square-pen">
              <path d="M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
              <path
                d="M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z" />
            </svg> Create letter</a>
          <% } %>
            <% if (currentUser && !currentUser.is_member) { %>
              <a class="join-membership-button" href="/membership-form"><svg xmlns="http://www.w3.org/2000/svg"
                  width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2"
                  stroke-linecap="round" stroke-linejoin="round"
                  class="lucide lucide-move-right-icon lucide-move-right">
                  <path d="M18 8L22 12L18 16" />
                  <path d="M2 12H22" />
                </svg> Join membership</a>
              <% } %>
      </div>
    </div>


    <!-- Letters display -->
    <div class="letters-container">
      <!-- <h2>Letters</h2> -->


      <% letters.forEach((letter)=> { %>
        <div class="letter-instance">
          <% if (currentUser) { %>
            <p class="author">
              <%= letter["username"] %>
            </p>
            <% } else { %>
              <p class="author">Anonymous user</p>
              <% } %>

                <p class="letter-text">
                  <%= letter["text"] %>
                </p>

                <% if (currentUser) { %>
                  <p class="letter-time" data-timestamp="<%= letter['timestamp'] %>"></p>

                  <% } else { %>
                    <p class="letter-time">Time is an illusion</p>
                    <% } %>


                      <% if (currentUser && currentUser.is_admin) { %>
                        <div class="letter-buttons">
                          <form method="post" action="/letter/delete/<%= letter["id"] %>">
                            <button class="del-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                                viewBox="0 0 24 24" fill="none" stroke="#f00a0a" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round" class="lucide lucide-trash-icon lucide-trash">
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" />
                                <path d="M3 6h18" />
                                <path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />
                              </svg></button>
                          </form>
                        </div>
                        <% } %>
        </div>
        <% }) %>
    </div>
  <script>
document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".letter-time").forEach(el => {
    const rawTimestamp = el.dataset.timestamp;
    if (!rawTimestamp) return;

    const date = new Date(rawTimestamp);

    el.textContent = date.toLocaleString("en-US", {
      year: "numeric",
      month: "short",
      day: "numeric",
      hour: "2-digit",
      minute: "2-digit",
      second: "2-digit",
      timeZoneName:"longGeneric",
    });
  });
});
</script>


</body>

</html>